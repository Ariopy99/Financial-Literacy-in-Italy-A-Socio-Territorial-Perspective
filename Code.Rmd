---
title: "DataScienceLab"
author: "Alberto Odierna"
date: "2024-07-13"
output: pdf_document
editor_options: 
  markdown: 
    wrap: 72
---

Importo le librerie:

```{r}
library(car)
library(readr)
library(MASS)
library(pscl)
library(ggplot2)
```

```{r setup, include=FALSE}
setwd("/Users/albertoarienti/Desktop/DataScienceLab")
ds <- read_csv("Financialliteracy.csv")
colnames(ds)[c(99:104)] <- c("Gender","Household","Age","Education","Employment","Country")
ds
```

Trasformo le variabili idonee in factor

```{r cars}
#Specificare le colonne da convertire in fattori
cols_to_factor <- colnames(ds)[c(3:100,102,104:106)]

# Convertire le colonne in fattori
ds[cols_to_factor] <- lapply(ds[cols_to_factor], factor)
```

Faccio una panoramica delle variabili socio-demografiche:

```{r}
require(skimr)
skim_without_charts(ds[99:106])
```

# 1 Analisi descrittiva

### 1.1 Analisi Univariata continua

```{r}
ds$Age1 <- ds$Age
```

```{r,eval = FALSE}
hist(ds$Age , main="Istogramma",  xlab="", ylab="", col="red4")
```

Discretizzo Age

```{r}
ds$Aged <- ifelse(ds$Age < 35,1,0)
ds$Aged <- ifelse(ds$Age >= 35 & ds$Age < 50,2,ds$Aged)
#ds$Aged <- ifelse(ds$Age >= 40 & ds$Age < 50,3,ds$Aged)
ds$Aged <- ifelse(ds$Age >= 50 & ds$Age < 65,3,ds$Aged)
ds$Aged <- ifelse(ds$Age >= 65,4,ds$Aged)
ds$Aged <- ordered(ds$Aged, levels= c(1:4))
table(ds$Aged)
```

### 1.2 Analisi univariata discreta

#### 1.2.1 Employment

```{r}
table(ds$Employment)
```

Abbiamo 7 categorie che riscrivo come

1 Self-employed 2 In paid employment 4 -\> 3 Looking after the home 5
-\> 4 Looking for work\
6 -\> 5 Retired\
9 -\> 6 Student\
10 -\> 7 Other

```{r}
#ds$Employment <- as.numeric(ds$Employment)
ds$Employment[ds$Employment == 4] <- 3
ds$Employment[ds$Employment == 5] <- 4
ds$Employment[ds$Employment == 6] <- 5
ds$Employment[ds$Employment == 9] <- 6
ds$Employment[ds$Employment == 10] <- 7

table(factor(ds$Employment))
ds$Employment <- factor(ds$Employment)
```

Creo una seconda variabile binaria Employment1 con valore 0/1 -\>
disoccupato/occupato

```{r}
ds$Employment1 <- ifelse(ds$Employment %in% c(1, 2), 1, 0)
table(ds$Employment1)
```

#### 1.2.2 Education:

1 University-level education 3 Complete secondary school 4 Some
secondary school 5 Complete primary school 6 Some primary school 7 No
formal education

```{r}
table(ds$Education)
```

La variabile "Education" risulta essere fortemente sbilanciata.

Calcolo l'eta media per l'education level 6 e 7

```{r}
ds[which(ds$Education == 6),c(99:106)]
ds[which(ds$Education == 7),c(99:106)]
mean(ds[which(ds$Education == 6),]$Age)
mean(ds[which(ds$Education == 7),]$Age)
```

L'unico individuo con "No formal Education"(7) risulta avere 23 anni
dato l'obbligo scolastico fino a 16 anni del 2006 è altamente
improbabile che l'individuo in questione non abbia nessuna educazione.
L'eta media delle persone con un livello d'istruzione "scuola primaria"
(6) è pari a 77

Unifico le categorie 5, 6 e 7.

```{r}
ds$Education[ds$Education == 6 | ds$Education == 7 ] <- 5
table(ds$Education)
```

Rendo la variabile idonea all'analisi assegnando a ciascuna categoria un
valore da 1 a 3. Al crescere del grado d'istruzione cresce il valore.
Quindi:

1 Some secondary school - Complete primary school - Some primary
school - No formal education 2 Complete secondary school 3
University-level education

```{r}
Education <- ds$Education
ds$Education <- as.numeric(ds$Education)
ds$Education[Education == 4| Education == 5]<-1
ds$Education[Education == 3]<-2
ds$Education[Education == 1]<-3
ds$Education <- ordered(factor(ds$Education),levels=c(1:3))
table(ds$Education)
```

#### 1.2.3 Households:

```{r}
table(ds$Household)
```

Data la bassa quantità di famiglie con nucleo familare dalle 4+ persone
unifico le due categorie 4, 5 e 6

```{r}
ds$Household[ds$Household == 6 | ds$Household == 5] <- 4
ds$Household <- ordered(ds$Household, levels = c(1:4))
table(ds$Household)
```

#### 1.2.4 Gender

```{r}
prop.table(table(ds$Gender))
```

La Variabile risulta essere bilanciata

#### 1.2.5 Country

```{r}
table(ds$Country)
```

Variabile fortemente sbilanciata. Abbiamo pochissimi individui non nati
in Italia

#### 1.2.6 Area5

```{r}
table(ds$AREA5)
```

Le categorie relative all'area geografica risultano essere bilanciate ad
eccezione della categoria 5 corrispondente alle Isole la quale presenta
una frequenza leggermente minore

### 1.3 Analisi Multivariata

#### 1.3.1 Educazione & Area5

```{r}
tab<-table(Education = ds$Education, area = ds$AREA5)
tab
#frequenze relative
prop.table(tab)
#Frequenze relative marginalizzate
prop.table(tab,margin=2)
prop.table(tab,margin=1)


```

####Education & Gender

```{r}
tab<-table(Education = ds$Education, Gender = ds$Gender)
tab
#frequenze relative
prop.table(tab, margin=2)
mosaicplot(tab)
```

#### 1.3.2 Education & Household

```{r}
tab<-table(Education = ds$Education, Household = ds$Household)
tab
#frequenze relative
prop.table(tab)
prop.table(tab, margin=1)
prop.table(tab, margin=2)

mosaicplot(tab)
```

#### 1.3.3 Household & Area5

```{r}
tab<-table(Household = ds$Household, Area= ds$AREA5)
prop.table(tab, margin = 1) 
```

Osservando la tabella della frequenza condizionate possiamo costatare
che vi sono più famiglie con un nucleo familiare maggiore pari a 5 (32%)
nell Sud Italia (Area=4) rispetto alle altre aree Geografiche. Trend
opposto al Sud italia dove abbiamo una frequenza condizionata più bassa
per le famiglie con un solo individu

# 2 Financial knowledge:

Effettua una analisi preliminare relativa alle domande che definisco la
conoscenza finanziaria.

```{r}
skim_without_charts(ds[92:98])
```

Non ci sono Missingvalue

Controllo il numero di righe con no answer (-99) per ciascuna knowledge
question:

```{r}

tab_99<-data.frame(
  c(
    length(which(ds$qk3 == -99)),
    length(which(ds$qk4 == -99)),
    length(which(ds$qk5 == -99)),
    length(which(ds$qk6 == -99)),
    length(which(ds$qk7_1 == -99)),
    length(which(ds$qk7_2 == -99)),
    length(which(ds$qk7_3 == -99))
  ),
  row.names = colnames(ds[92:98])
)
colnames(tab_99) <- "N_noAnsware"
tab_99
```

Calcolo la conoscenza finanziaria. Tutte le risposte con valore "-99"
assegno valore 0 Calcolo lo knowledge score assegnando 1 punto se: - qk3
= 3 - qk4 = 0(%) - qk5 = 102 - qk6 = 1 - qk7_1 = 1 - qk7_2 = 1 - qk7_3 =
1 per i restanti valori assegno punteggio 0. Il punteggio calcolato va
da 0 a 7.

```{r pressure, echo=FALSE}
know<-ds[1]
know$qk3 <- ifelse(ds$qk3 == 3,1,0)
know$qk4 <- ifelse(ds$qk4 == 0,1,0)
know$qk5 <- ifelse(ds$qk5 == 102 ,1,0)
know$qk6 <- ifelse(ds$qk6 == 2 ,1,0)
know$qk7_1 <- ifelse(ds$qk7_1 == 1,1,0)
know$qk7_2 <- ifelse(ds$qk7_2 == 1,1,0)
know$qk7_3 <- ifelse(ds$qk7_3 == 1,1,0)
know$tot <- unlist(know$qk3+know$qk4+know$qk5+know$qk6+know$qk7_1+know$qk7_2+know$qk7_3)

know$tot <- ordered(know$tot, levels = c(0:7))
```

## 2.0 Analizzo il knowledge score:

```{r}
table(know$tot)
plot(know$tot,col=c("#0077FF"))
```

```{r}
tab<-table(score = know$tot, area = ds$AREA5)
tab
barplot(tab,col=c("blue","red","yellow","green","orange","brown","pink","black"),main="Grafico frequenza voti e posizione geografica",names.arg = c("North-west","North-East", "Centre","South","Islands"))
legend("topright",                     # Posizione della legenda
       legend = c("0","1","2","3","4","5","6",7),  # Etichette della legenda (categorie)
       fill = c("blue","red","yellow","green","orange","brown","pink","black"))
#frequenze relative
prop.table(tab)
#Eta media per ciascun livello
tapply(ds$Age, know$tot, mean)
```

## 2.1 Modello di regressione ordinale

Osservo le distribuzioni di frequenza:

```{r}
table(know$tot, ds$Gender)
table(know$tot, ds$Aged)
table(know$tot, ds$Education)
```

Riduco il numero di livelli della variabile dipendente da 8 a 3 labels:

```{r}
table(know$tot)
```

```{r}
know$tot1 <- know$tot
know$tot1[know$tot == 0 | know$tot == 1 | know$tot == 2] <- 1
know$tot1[know$tot == 3 | know$tot == 4] <- 2
know$tot1[know$tot == 5 |know$tot == 6 | know$tot == 7] <- 3
know$tot1 <- ordered(factor(know$tot1),levels=c(1:3))
```

```{r}
table(know$tot1)
```

### Modello Completo

```{r}
mod1_1<- polr(know$tot1 ~ Gender + Household + Aged + Education + Employment1 + Country + AREA5 ,ds)
summary(mod1_1)
```

###Variable Selection

```{r}
Anova(mod1_1, type = "II", test.statistic = "LR")
```

```{r}
step(mod1_1)
```

### Modello ridotto

```{r}
mod1_2<- polr(know$tot1 ~ Gender + Age1 + Education, ds)
summary(mod1_2)
summary_table <- coef(summary(mod1_2))
pval <- pt(abs(summary_table[, "t value"]),lower.tail = FALSE,nrow(ds)-4)
summary_table <- cbind(summary_table, "p value" = round(pval,5))
summary_table
```

```{r}
library(brant)
brant(mod1_2)
```

L'assunzione di regressione parallela sembra essere soddisfatta, quindi
il modello di regressione ordinale scelto è appropriato.

### Modello completo vs ridotto

```{r}
anova(mod1_1,mod1_2,  test = "Chisq")
```

Il p-value del Likelihood Ratio Test è 0.0573, significa che la
differenza tra i due modelli non è altamente significativa. Questo
implica che l'ipotesi nulla (che afferma che il modello ridotto è
sufficiente per spiegare i dati, deve essere accettata)

### Modello ridotto vs nullo

```{r}
mod1_0 <- polr(know$tot1 ~ 1)
anova(mod1_2, mod1_0, test = "Chisq")
```

Seleziono modello ridotto

# 3 Financial Attitude

Lo calcolo utilizzando le domande QF10_2, QF10_3 e QF10_5

Analisi variabili:

(vedere meglio come gestire le non risposte)

```{r}
table(ds$qf10_2)
table(ds$qf10_3)
table(ds$qf10_5)
```

```{r}
ds[which((ds$qf10_2 == -97 | ds$qf10_2 == -99) & (ds$qf10_3 == -97 | ds$qf10_3 == -99) & (ds$qf10_8 == -97 | ds$qf10_8 == -99)),c(1,59,60,65)]
ds[which((ds$qf10_3 == -97 | ds$qf10_3 == -99) & (ds$qf10_8 == -97 | ds$qf10_8 == -99)),c(59,60,65)]
ds[which((ds$qf10_2 == -97 | ds$qf10_2 == -99) & (ds$qf10_8 == -97 | ds$qf10_8 == -99)),c(59,60,65)]
ds[which((ds$qf10_3 == -97 | ds$qf10_3 == -99) & (ds$qf10_8 == -97 | ds$qf10_8 == -99)),c(59,60,65)]
```

NO ANSWARE(-99) e DON'T KNOW (-97) elimina le osservazioni e inverto
l'ordine di qf5. Interpreto ciascuna domanda come un punteggio più alto
indica un'attitudine al rischio maggiore. Per tal motivo inverto
l'ordine nella risposte qf2 e qf3

```{r}
ds_R <- ds[!(ds$qf10_2 %in% c(-99, -97) | ds$qf10_3 %in% c(-99, -97) | ds$qf10_5 %in% c(-99, -97)| ds$qf10_7 %in% c(-99, -97) | ds$qf10_8 %in% c(-99, -97)), ]

Attitude <- ds_R[1]

Attitude$qf10_2 <- ds_R$qf10_2
Attitude$qf10_3 <- ds_R$qf10_3
Attitude$qf10_5 <- ds_R$qf10_5
Attitude$qf10_7 <- ds_R$qf10_7
Attitude$qf10_8 <- ds_R$qf10_8


Attitude$qf10_7[ds_R$qf10_7 == 1] <- 5
Attitude$qf10_7[ds_R$qf10_7 == 2] <- 4
Attitude$qf10_7[ds_R$qf10_7 == 3] <- 3
Attitude$qf10_7[ds_R$qf10_7 == 4] <- 2
Attitude$qf10_7[ds_R$qf10_7 == 5] <- 1
```

```{r}
Attitude$qf10_2 <- ordered(Attitude$qf10_2, level=c(1:5))
Attitude$qf10_3 <- ordered(Attitude$qf10_3, level=c(1:5))
Attitude$qf10_5 <- ordered(Attitude$qf10_5, level=c(1:5))
Attitude$qf10_7 <- ordered(Attitude$qf10_5, level=c(1:5))
Attitude$qf10_8 <- ordered(Attitude$qf10_5, level=c(1:5))
```

```{r}
table(Attitude$qf10_2)
table(Attitude$qf10_3)
table(Attitude$qf10_5)

table(ds_R$qf10_2)
table(ds_R$qf10_3)
```

Calcolo lo score: (QF10_2 + QF10_3 + QF10_5 + QF10_7 +QF10_8) / 5

```{r}
Attitude$score <- round(unlist((as.numeric(as.character(Attitude$qf10_2)) + as.numeric(as.character(Attitude$qf10_3)) + as.numeric(as.character(Attitude$qf10_7)) + as.numeric(as.character(Attitude$qf10_8)))/4))
Attitude$score <- ordered(Attitude$score, levels = c(1:5))
table(Attitude$score)
```

Riduco il numero di categorie. Distinguendo tre tipologie di individui

Se: - 1,2 allora assegno 1 -\> bassa attitudine al rischio - 3 allora
assegno 2 -\> indifferente - 4,5 allora assegno 3 -\> propensione al
rischio

```{r}
Attitude$score2 <- Attitude$score
Attitude$score2[Attitude$score == 1 | Attitude$score == 2] <- 1
Attitude$score2[Attitude$score == 3] <- 2
Attitude$score2[Attitude$score == 4 | Attitude$score == 5] <- 3
Attitude$score2 <- ordered(Attitude$score2, levels=c(1:3))
```

## 3.1 Investment attitude

### Modello completo

```{r}
mod2_1<- polr(Attitude$score2 ~ Gender + Household + Aged + Education + Employment1 + Country + AREA5 ,ds_R)
summary(mod2_1)
```

### Variable selecition

```{r}
library(car)
Anova(mod2_1, type = "II", test.statistic = "LR")
```

```{r}
step(mod2_1)
```

### Modello ridotto 1

```{r}
mod2_2 <- polr(Attitude$score2 ~ Gender + Aged + AREA5, ds_R)
summary_table <- coef(summary(mod2_2))
pval <- pnorm(abs(summary_table[, "t value"]),lower.tail = FALSE)* 2
summary_table <- cbind(summary_table, "p value" = round(pval,5))
summary_table
summary(mod2_2)
```

```{r}
library(brant)
brant(mod2_2)
```

L'assunzione di regressione parallela sembra essere soddisfatta, quindi
il modello di regressione ordinale scelto è appropriato.

### Modello ridotto 2

```{r}
mod2_3 <- polr(Attitude$score2 ~ Gender + Aged, ds_R)
summary_table <- coef(summary(mod2_3))
pval <- pnorm(abs(summary_table[, "t value"]),lower.tail = FALSE)* 2
summary_table <- cbind(summary_table, "p value" = round(pval,5))
summary_table
summary(mod2_3)
```

```{r}
library(brant)
brant(mod2_3)
```

L'assunzione di regressione parallela sembra essere soddisfatta, quindi
il modello di regressione ordinale scelto è appropriato.

### Modello completo vs ridotto:

```{r}
anova(mod2_1, mod2_2, test = "Chisq")
```

Accetto H0 quindi non vi è una differenza significativa tra modello
completo e modello ridotto. Prendo ridotto

```{r}
anova(mod2_2, mod2_3, test = "Chisq")
```

Test di likelihood mi spinge ad utilizzare il modello ridotto 2_3

### Modello ridotto vs modello nullo

```{r}
mod2_0 <- polr(Attitude$score2 ~ 1)
anova(mod2_3, mod2_0, test = "Chisq")
```

Modello completo ridotto 2_3

## 3.2 Risk attitude

```{r}
table(Attitude$qf10_5)
```

```{r}
Attitude$risk1 <- 1
Attitude$risk1[Attitude$qf10_5==5|Attitude$qf10_5==4] <- 0
Attitude$risk1 <- factor(Attitude$risk1)
table(Attitude$risk1)
```

### Modello completo

```{r}
mod21_1 <- glm(Attitude$risk1 ~ Gender + Household + Aged + Education + Employment1 + Country + AREA5, family = "binomial", data = ds_R)
summary(mod21_1)
```

###Variable Selection

```{r}
Anova(mod21_1, type = "II", test.statistic = "LR")
```

```{r}
step(mod21_1)
```

### Modello ridotto 1

```{r}
mod21_2 <- glm(Attitude$risk1 ~  Gender + Aged + Education,family = "binomial", ds_R)
summary(mod21_2)
```

###Modello ridotto 2

```{r}
mod21_3 <- glm(Attitude$risk1 ~  Gender + Aged,family = "binomial", ds_R)
summary(mod21_3)
```

### Modello completo vs ridotto

```{r}
anova(mod21_1, mod21_2, test = "Chisq")
```

```{r}
anova(mod21_2, mod21_3, test = "Chisq")
```

### Modello ridotto vs nullo

```{r}
mod21_0 <- glm(Attitude$risk1 ~ 1,family = "binomial", ds_R)
anova(mod21_3, mod21_0, test = "Chisq")
```

Seleziono modello ridotto 21_3

# 4 Retirement

With the next models, we are going to tackle questions related to
retirement savings (QF8 and QF9).

## 4.1 Who does not think to have a good retirement plan?

```{r}
table(ds$qf8)
```

There are 139 individuals that have not provided an answer for the
question, we are going to create a subset that does not include these
observations:

```{r}
dsR <- ds[!(ds$qf8 == -99),]
rknow <- know[!(ds$qf8 == -99),]
dsR$know <- rknow$tot
dsR <- dsR[!(dsR$qf8 == -97),]
dsR$qf8 <- ordered(dsR$qf8, levels = c(6:1))
```

### Modello Completo

Once again, we are going to use the "polr" function to estimate the
Proportional Odds Logistic Regression Model:

```{r}
modRet1 <- polr(qf8 ~  Gender + Household + Age1 + Education + Employment1 + AREA5 + know, data = dsR, Hess = TRUE)
summary(modRet1)
```

### Feature selection

```{r}
step(modRet1)
```

ANOVA di tipo II con il test Likelihood Ratio (LRT):

Il test valuta l'effetto di ciascun predittore nel contesto del modello
completo, confrontando la devianza del modello completo con quella del
modello ridotto (senza il predittore in esame).

```{r}
Anova(modRet1, type = "II", test.statistic = "LR")
```

###Modello ridotto 1

We re-estimate the model utilizing only the variables that have been
selected through the AIC criterion:

```{r}
modRet2 <- polr(formula = qf8 ~ Age1 + Education + Employment1 + AREA5, data = dsR, Hess = TRUE)
summary(modRet2)
```

We compute the p-values:

```{r}
summary_table <- coef(summary(modRet2))
pval <- pnorm(abs(summary_table[, "t value"]),lower.tail = FALSE)* 2
summary_table <- cbind(summary_table, "p value" = round(pval,5))
summary_table
```

We are now going to estimate a regression only with knowledge score, in
order to understand the association that this variable has with the
answer qf8:

Once again, the p-values are computed here:

```{r}
summary_table <- coef(summary(modRet2))
pval <- pnorm(abs(summary_table[, "t value"]),lower.tail = FALSE)* 2
summary_table <- cbind(summary_table, "p value" = round(pval,5))
summary_table
```

```{r}
library(brant)
brant(modRet2)
```

L'assunzione di regressione parallela sembra essere soddisfatta, quindi
il modello di regressione ordinale scelto è appropriato.

### Modello completo vs ridotto

```{r}
anova(modRet1, modRet2, test = "Chisq")
```

Seleziono modello ridotto

### Modello ridotto vs nullo

```{r}
modRet0 <- polr(formula = qf8 ~ 1, data = dsR, Hess = TRUE)
anova(modRet2, modRet0, test = "Chisq")
```

Seleziono modello ridotto

## 4.2 QF9: Who does utilize more secure tools for building their retirement fund?

We classify answer a-f and i as a stable/secure retirement plan (1),
while all the other answer are considered unsecure (0). We are
interested in identifying those variables that are related to the choice
of an unsecure retirement plan.

```{r}
table(ds$qf9_99)
```

```{r}
dsR2 <- ds[!(ds$qf9_99==1),]
```

```{r}
# We create a new column that contain the sum of the columns related to secure retirement plans
dsR2$sum <- as.numeric(as.character(dsR2$qf9_1)) + as.numeric(as.character(dsR2$qf9_2)) + as.numeric(as.character(dsR2$qf9_3)) + as.numeric(as.character(dsR2$qf9_4)) + as.numeric(as.character(dsR2$qf9_5)) + as.numeric(as.character(dsR2$qf9_6))
# We transform the observation that have any value different from 0 in this new column to 1.
# In this way any observation that have at least one secure tool for building their
# retirement plan will be classified as 1.
# While all the other observation will remain equal to zero.
dsR2$sum[dsR2$sum != 0] <- 1
```

```{r}
dsR2$sum <- factor(dsR2$sum, levels = c(0,1))
```

### Modello completo

We now estimate the model and apply the Akaike Information Criterion:

```{r}
mod_qf9_1 <- glm(sum ~ Gender + Household + Aged + Education + Employment1 + Country + AREA5, data = dsR2, family = "binomial")
summary(mod_qf9_1)
```

### Variable Selection

```{r}
step(mod_qf9_1)
```

ANOVA di tipo II con il test Likelihood Ratio (LRT):

Il test valuta l'effetto di ciascun predittore nel contesto del modello
completo, confrontando la devianza del modello completo con quella del
modello ridotto (senza il predittore in esame).

```{r}
Anova(modRet1, type = "II", test.statistic = "LR")
```

### Modello ridotto 1

Now we re-estimate the model with the variables identified by the AIC:

```{r}
mod_qf9_2 <- glm(sum ~ Age1 + Education + Employment1 + AREA5, data = dsR2, family = "binomial")
summary(mod_qf9_2)
```

We are now going to build a stacked bar-plot to further investigate the
relationship between employment status and the answer to QF9:

```{r}
# Stacked
ggplot(dsR2, aes(fill=factor(sum, levels=c(0,1)), y = after_stat(count), x=Employment1)) + 
    geom_bar(position="stack", stat="count") +
    xlab("Employment Status") +
#    legend("topleft", legend = c("Unsecure tools for retirement", "Secure tools for retirement"))
    scale_fill_discrete(labels=c('Risky', 'Safe')) +
    guides(fill=guide_legend(title="Tools for Retirement:")) +
    scale_x_discrete(labels= c("Unemployed", "Employed"))
```

### Modello completo vs ridotto

```{r}
anova(mod_qf9_1, mod_qf9_2, test = "Chisq")
```

Modello completo.

# 5 Personal Finance

In this section we are going to tackle questions related to Personal
Finance (savings): QF3 and QF4

## 5.1 QF3 - Who uses non-smart ways to save money?

We classify answer b, d, e as a secure way of saving money (1), while
all the other answer are considered unsecure (0). We are interested in
identifying those variables that are related to the choice of an
unsecure plan for personal savings.

We remove the observation that have not given an answer for this
question (155)

```{r}
dsPF3 <- ds[!(ds$qf3_99==1),]
```

```{r}
dsPF3$sum <- as.numeric(as.character(dsPF3$qf3_3)) + as.numeric(as.character(dsPF3$qf3_6)) + as.numeric(as.character(dsPF3$qf3_7))
dsPF3$sum[dsPF3$sum != 0] <- 1
```

```{r}
dsPF3$sum <- factor(dsPF3$sum, levels = c(0,1))
```

### Modello completo

```{r}
mod_PF3 <- glm(sum ~ Gender + Household + Aged + Education + Employment1 + Country + AREA5, data = dsPF3, family = "binomial")
summary(mod_PF3)
```

### Variable selections

```{r}
step(mod_PF3)
```

```{r}
Anova(mod_PF3, type = "II", test.statistic = "LR")
```

### Modello ridotto 1

```{r}
mod_PF3_1 <- glm(sum ~  Household + Aged + Education + Employment1 + AREA5, data = dsPF3, family = "binomial")
summary(mod_PF3_1)
```

### Modello completo vs ridotto

```{r}
anova(mod_PF3, mod_PF3_1, test = "Chisq")
```

Modello ridotto

### Modello ridotto vs nullo

```{r}
mod_PF3_0 <- glm(sum ~  1, data = dsPF3, family = "binomial")
anova(mod_PF3_0, mod_PF3_1, test = "Chisq")
```

Seleziono modello ridotto 1

## 5.2 QF4 - Who is not capable of sustaining an imporvise expense?

```{r}
# We remove the observation that have not given an answer for this question,
# and those who have not a personal income (78 + 255)
dsPF4 <- ds[!(ds$qf4 == -99),]
dsPF4 <- dsPF4[!(dsPF4$qf4 == -98),]
```

```{r}
# We transform all the observation that have not answered with 1 ("Yes") as 0 (negative category)
# This is because "not knowing" is considered a negative response to the question
dsPF4$qf4[dsPF4$qf4 != 1] <- 0
```

```{r}
dsPF4$qf4 <- factor(dsPF4$qf4, levels = c(0,1))
```

### Modello completo

```{r}
mod_PF4 <- glm(qf4 ~ Gender + Age1 + Education + Employment1 + AREA5 + Household, data = dsPF4, family = "binomial")
summary(mod_PF4)
```

### Variable selection

```{r}
step(mod_PF4)
```

ANOVA di tipo II con il test Likelihood Ratio (LRT):

Il test valuta l'effetto di ciascun predittore nel contesto del modello
completo, confrontando la devianza del modello completo con quella del
modello ridotto (senza il predittore in esame).

```{r}
Anova(mod_PF4, type = "II", test.statistic = "LR")
```

### Modello ridotto 1

```{r}
mod_PF4_1 <- glm(qf4 ~ Age1 + Education + Employment1 + AREA5, family = "binomial", data = dsPF4)
summary(mod_PF4_1)
```

### Modello completo vs ridotto

```{r}
anova(mod_PF4, mod_PF4_1, test = "Chisq")
```

Seleziono modello ridotto

### Modello ridotto vs nullo

```{r}
mod_PF4_0 <- glm(qf4 ~ 1, family = "binomial", data = dsPF4)
anova(mod_PF4_1, mod_PF4_0, test = "Chisq")
```

Seleziono modello ridotto 1
